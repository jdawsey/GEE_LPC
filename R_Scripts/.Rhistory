mgrvi <- image_given$expression(mgrvi_exp)$rename('mgrvi')
mgrvi <- as.integer(mgrvi)
#ndvi <- normalized$normalizedDifference(c('N', 'R'))$rename('ndvi')
}
clip <- normalized$addBands(rgb_bandMath(normalized))
#Doesn't work for NM 2009 -- see "check bands"
#band_names <- normalized$bandNames()
#print(band_names$get(4)$getInfo())
rgb_bandMath <- function(image_given) {
vari_exp <- '(b("G") - b("R")) / (b("G") + b("R") - b("B")'
mgrvi_exp <- '(b("G")^2 - b("R")^2) / (b("G")^2 + b("R")^2)'
vari <- image_given$expression(vari_exp)$rename('vari')
vari <- vari$toInt()
mgrvi <- image_given$expression(mgrvi_exp)$rename('mgrvi')
mgrvi <- mgrvi$toInt()
#ndvi <- normalized$normalizedDifference(c('N', 'R'))$rename('ndvi')
}
clip <- normalized$addBands(rgb_bandMath(normalized))
### DoG sharpening
fat <- ee$Kernel$gaussian(
radius = 3,
sigma = 3,
magnitude = -1.0,
units = 'pixels'
)
skinny <- ee$Kernel$gaussian(
radius = 3,
sigma = 0.5,
units = 'pixels'
)
dog <- fat$add(skinny)
sharpened <- clip$add(clip$convolve(dog))
###
### gaussian smoothing
gaussianKernel <- ee$Kernel$gaussian(
radius = 3,
units = 'pixels'
)
gauss <- sharpened$convolve(gaussianKernel)
###
### adding the sharpened then smoothed image to the map
Map$addLayer(gauss, visParams = visParam)
#Doesn't work for NM 2009 -- see "check bands"
#band_names <- normalized$bandNames()
#print(band_names$get(4)$getInfo())
rgb_bandMath <- function(image_given) {
vari_exp <- '(b("G") - b("R")) / (b("G") + b("R") - b("B")'
mgrvi_exp <- '(b("G")**2 - b("R")**2) / (b("G")**2 + b("R")**2)'
vari <- image_given$expression(vari_exp)$rename('vari')
#vari <- vari$toInt()
mgrvi <- image_given$expression(mgrvi_exp)$rename('mgrvi')
#mgrvi <- mgrvi$toInt()
#ndvi <- normalized$normalizedDifference(c('N', 'R'))$rename('ndvi')
}
clip <- normalized$addBands(rgb_bandMath(normalized))
### DoG sharpening
fat <- ee$Kernel$gaussian(
radius = 3,
sigma = 3,
magnitude = -1.0,
units = 'pixels'
)
skinny <- ee$Kernel$gaussian(
radius = 3,
sigma = 0.5,
units = 'pixels'
)
dog <- fat$add(skinny)
sharpened <- clip$add(clip$convolve(dog))
###
### gaussian smoothing
gaussianKernel <- ee$Kernel$gaussian(
radius = 3,
units = 'pixels'
)
gauss <- sharpened$convolve(gaussianKernel)
###
### adding the sharpened then smoothed image to the map
Map$addLayer(gauss, visParams = visParam)
### DoG sharpening
fat <- ee$Kernel$gaussian(
radius = 3,
sigma = 3,
magnitude = -1.0,
units = 'pixels'
)
skinny <- ee$Kernel$gaussian(
radius = 3,
sigma = 0.5,
units = 'pixels'
)
dog <- fat$add(skinny)
sharpened <- clip$add(clip$convolve(dog))
###
### gaussian smoothing
gaussianKernel <- ee$Kernel$gaussian(
radius = 3,
units = 'pixels'
)
gauss <- sharpened$convolve(gaussianKernel)
###
visParamGauss <- list(bands <- c('R', 'G', 'B'),
min= 0,
max= 255
)
### adding the sharpened then smoothed image to the map
Map$addLayer(gauss, visParams = visParamGauss)
### change the feature collection to your boundary asset location
shp <- ee$FeatureCollection('users/jdawsey/assets/20km_nm')
### choose your imagery and the dates for it
year <- ee$ImageCollection('USDA/NAIP/DOQQ') %>%
ee$ImageCollection$filterDate(ee$Date('2009-01-01'),
ee$Date('2009-12-31')) %>%
ee$ImageCollection$filterBounds(shp)
# mosaic the collection into a single image
year <- year$mosaic()
### clipping to shape
clip <- year$clip(shp)
###
### visibility parameters for the color image
visParam <- list(bands <- c('R', 'G', 'B'),
gamma = 1
)
# centering and adding to map to check that it's visualizing properly
Map$centerObject(shp)
Map$addLayer(clip, visParams= visParam)
### creating training samples for the unsupervised classification
training <- gauss$sample(
region = shp,
scale = 0.6, #change per resolution
numPixels = 10000
)
###
### the actual classification function
clusterer <- ee$Clusterer$wekaKMeans(15) %>% # change clusters depending on imagery
ee$Clusterer$train(training)
result <- gauss$cluster(clusterer)
###
### creating a landcover palette to view the result
landcoverPalette <- c(
'#00a944',
'#d6d6d6',
'#c65b8d',
'#ded132',
'#ff3434',
'#5bb48f',
'#47f37c',
'#c04848',
'#ded132',
'#5bb48f',
'#0f0077',
'#778bff',
'#8f8f8f',
'#000000',
'#d9a300'
)
visPalette <- list(
min= 0,
max= 9, # change depending on number of clusters
palette = landcoverPalette
)
###
### adding maps to compare
classified <- Map$addLayer(result, visParams = visPalette)
imageryMap <- Map$addLayer(clip, visParams= visParam)
###
### showing the maps
classified | imageryMap
#Doesn't work for NM 2009 -- see "check bands"
#band_names <- normalized$bandNames()
#print(band_names$get(4)$getInfo())
rgb_bandMath <- function(image_given) {
vari_exp <- '(b("G") - b("R")) / (b("G") + b("R") - b("B")'
mgrvi_exp <- '(b("G")**2 - b("R")**2) / (b("G")**2 + b("R")**2)'
vari <- image_given$expression(vari_exp)$rename('vari')
mgrvi <- image_given$expression(mgrvi_exp)$rename('mgrvi')
#ndvi <- normalized$normalizedDifference(c('N', 'R'))$rename('ndvi')
}
normalized <- normalized$addBands(rgb_bandMath(normalized))
band_names <- normalized$bandNames()
print(band_names$get(4)$getInfo())
#Doesn't work for NM 2009 -- see "check bands"
#band_names <- normalized$bandNames()
#print(band_names$get(4)$getInfo())
rgb_bandMath <- function(image_given) {
vari_exp <- '(b("G") - b("R")) / (b("G") + b("R") - b("B")'
mgrvi_exp <- '(b("G")**2 - b("R")**2) / (b("G")**2 + b("R")**2)'
vari <- image_given$expression(vari_exp)$rename('vari')
mgrvi <- image_given$expression(mgrvi_exp)$rename('mgrvi')
#ndvi <- normalized$normalizedDifference(c('N', 'R'))$rename('ndvi')
image_give <- image_given$addBands(vari)$addBands(mgrvi)
}
normalized <- rgb_bandMath(normalized)
band_names <- normalized$bandNames()
print(band_names$get(4)$getInfo())
#Doesn't work for NM 2009 -- see "check bands"
#band_names <- normalized$bandNames()
#print(band_names$get(4)$getInfo())
rgb_bandMath <- function(image_given) {
vari_exp <- '(b("G") - b("R")) / (b("G") + b("R") - b("B"))'
mgrvi_exp <- '(b("G")**2 - b("R")**2) / (b("G")**2 + b("R")**2)'
vari <- image_given$expression(vari_exp)$rename('vari')
mgrvi <- image_given$expression(mgrvi_exp)$rename('mgrvi')
#ndvi <- normalized$normalizedDifference(c('N', 'R'))$rename('ndvi')
image_give <- image_given$addBands(vari)$addBands(mgrvi)
}
normalized <- rgb_bandMath(normalized)
band_names <- normalized$bandNames()
print(band_names$get(4)$getInfo())
#Doesn't work for NM 2009 -- see "check bands"
#band_names <- normalized$bandNames()
#print(band_names$get(4)$getInfo())
rgb_bandMath <- function(image_given) {
vari_exp <- '(b("G") - b("R")) / (b("G") + b("R") - b("B"))'
mgrvi_exp <- '(b("G")**2 - b("R")**2) / (b("G")**2 + b("R")**2)'
vari <- image_given$expression(vari_exp)$rename('vari')
mgrvi <- image_given$expression(mgrvi_exp)$rename('mgrvi')
#ndvi <- normalized$normalizedDifference(c('N', 'R'))$rename('ndvi')
image_give <- image_given$addBands(vari)
image_give <- image_given$addBands(mgrvi)
}
normalized <- rgb_bandMath(normalized)
band_names <- normalized$bandNames()
print(band_names$get(4)$getInfo())
#Doesn't work for NM 2009 -- see "check bands"
#band_names <- normalized$bandNames()
#print(band_names$get(4)$getInfo())
rgb_bandMath <- function(image_given) {
vari_exp = ' ((b("G") - b("R")) / (b("G") + b("R") - b("B"))) '
mgrvi_exp = '(b("G")**2 - b("R")**2) / (b("G")**2 + b("R")**2)'
vari <- image_given$expression(vari_exp)$rename('vari')
mgrvi <- image_given$expression(mgrvi_exp)$rename('mgrvi')
#ndvi <- normalized$normalizedDifference(c('N', 'R'))$rename('ndvi')
image_give <- image_given$addBands(vari)
image_give <- image_given$addBands(mgrvi)
}
normalized <- rgb_bandMath(normalized)
band_names <- normalized$bandNames()
print(band_names$get(4)$getInfo())
#Doesn't work for NM 2009 -- see "check bands"
#band_names <- normalized$bandNames()
#print(band_names$get(4)$getInfo())
rgb_bandMath <- function(image_given) {
vari_exp = ' ((b("G") - b("R")) / (b("G") + b("R") - b("B")))'
mgrvi_exp = '((b("G")**2 - b("R")**2) / (b("G")**2 + b("R")**2))'
vari <- image_given$expression(vari_exp)$rename('vari')
mgrvi <- image_given$expression(mgrvi_exp)$rename('mgrvi')
#ndvi <- normalized$normalizedDifference(c('N', 'R'))$rename('ndvi')
image_give <- image_given$addBands(vari)
image_give <- image_given$addBands(mgrvi)
}
normalized <- rgb_bandMath(normalized)
band_names <- normalized$bandNames()
print(band_names$get(4)$getInfo())
#Doesn't work for NM 2009 -- see "check bands"
#band_names <- normalized$bandNames()
#print(band_names$get(4)$getInfo())
rgb_bandMath <- function(image_given) {
vari_exp = ' ((b("G") - b("R")) / (b("G") + b("R") - b("B")))'
mgrvi_exp = '((b("G")**2 - b("R")**2) / (b("G")**2 + b("R")**2))'
vari <- image_given$expression(vari_exp)$rename('vari')
mgrvi <- image_given$expression(mgrvi_exp)$rename('mgrvi')
#ndvi <- normalized$normalizedDifference(c('N', 'R'))$rename('ndvi')
image_give <- image_given$addBands(vari)
image_give <- image_given$addBands(mgrvi)
}
normalized <- rgb_bandMath(normalized)
band_names <- normalized$bandNames()
Map$addLayer(normalized, 'vari')
#Doesn't work for NM 2009 -- see "check bands"
#band_names <- normalized$bandNames()
#print(band_names$get(4)$getInfo())
rgb_bandMath <- function(image_given) {
vari_exp = ' ((b("G") - b("R")) / (b("G") + b("R") - b("B")))'
mgrvi_exp = '((b("G")**2 - b("R")**2) / (b("G")**2 + b("R")**2))'
vari <- image_given$expression(vari_exp)$rename('vari')
mgrvi <- image_given$expression(mgrvi_exp)$rename('mgrvi')
#ndvi <- normalized$normalizedDifference(c('N', 'R'))$rename('ndvi')
image_give <- image_given$addBands(vari)
image_give <- image_given$addBands(mgrvi)
}
normalized <- rgb_bandMath(normalized)
band_names <- normalized$bandNames()
vari_param <- list(bands = 'vari',
min = 0,
max = 1)
Map$addLayer(normalized, vari_param, 'vari')
#Doesn't work for NM 2009 -- see "check bands"
#band_names <- normalized$bandNames()
#print(band_names$get(4)$getInfo())
rgb_bandMath <- function(image_given) {
vari_exp = '((b("G") - b("R")) / (b("G") + b("R") - b("B")))'''
#Doesn't work for NM 2009 -- see "check bands"
#band_names <- normalized$bandNames()
#print(band_names$get(4)$getInfo())
rgb_bandMath <- function(image_given) {
vari_exp = '((b("G") - b("R")) / (b("G") + b("R") - b("B")))'
mgrvi_exp = '((b("G")**2 - b("R")**2) / (b("G")**2 + b("R")**2))'
vari <- image_given$expression(vari_exp)$rename('vari')
mgrvi <- image_given$expression(mgrvi_exp)$rename('mgrvi')
#ndvi <- normalized$normalizedDifference(c('N', 'R'))$rename('ndvi')
image_give <- image_given$addBands(vari)
image_give <- image_given$addBands(mgrvi)
}
normalized <- rgb_bandMath(normalized)
band_names <- normalized$bandNames()
vari_param <- list(bands = 'vari',
min = 0,
max = 1)
Map$addLayer(normalized, vari_param, 'vari')
#Doesn't work for NM 2009 -- see "check bands"
#band_names <- normalized$bandNames()
#print(band_names$get(4)$getInfo())
rgb_bandMath <- function(image_given) {
vari_exp = "((b('G') - b('R')) / (b('G') + b('R') - b('B')))"
mgrvi_exp = '((b("G")**2 - b("R")**2) / (b("G")**2 + b("R")**2))'
vari <- image_given$expression(vari_exp)$rename('vari')
mgrvi <- image_given$expression(mgrvi_exp)$rename('mgrvi')
#ndvi <- normalized$normalizedDifference(c('N', 'R'))$rename('ndvi')
image_give <- image_given$addBands(vari)
image_give <- image_given$addBands(mgrvi)
}
normalized <- rgb_bandMath(normalized)
band_names <- normalized$bandNames()
vari_param <- list(bands = 'vari',
min = 0,
max = 1)
Map$addLayer(normalized, vari_param, 'vari')
#Doesn't work for NM 2009 -- see "check bands"
#band_names <- normalized$bandNames()
#print(band_names$get(4)$getInfo())
rgb_bandMath <- function(image_given) {
vari_exp = "((b('G') - b('R')) / (b('G') + b('R') - b('B')))"
mgrvi_exp = '((b("G")**2) - (b("R")**2) / ((b("G")**2) + (b("R")**2)))'
vari <- image_given$expression(vari_exp)$rename('vari')
mgrvi <- image_given$expression(mgrvi_exp)$rename('mgrvi')
#ndvi <- normalized$normalizedDifference(c('N', 'R'))$rename('ndvi')
image_give <- image_given$addBands(vari)
image_give <- image_given$addBands(mgrvi)
}
normalized <- rgb_bandMath(normalized)
band_names <- normalized$bandNames()
vari_param <- list(bands = 'vari',
min = 0,
max = 1)
Map$addLayer(normalized, vari_param, 'vari')
#Doesn't work for NM 2009 -- see "check bands"
#band_names <- normalized$bandNames()
#print(band_names$get(4)$getInfo())
rgb_bandMath <- function(image_given) {
vari_exp = "((b('G') - b('R')) / (b('G') + b('R') - b('B')))";
mgrvi_exp = '((b("G")**2) - (b("R")**2) / ((b("G")**2) + (b("R")**2)))'
vari <- image_given$expression(vari_exp)$rename('vari')
mgrvi <- image_given$expression(mgrvi_exp)$rename('mgrvi')
#ndvi <- normalized$normalizedDifference(c('N', 'R'))$rename('ndvi')
image_give <- image_given$addBands(vari)
image_give <- image_given$addBands(mgrvi)
}
normalized <- rgb_bandMath(normalized)
band_names <- normalized$bandNames()
vari_param <- list(bands = 'vari',
min = 0,
max = 1)
Map$addLayer(normalized, vari_param, 'vari')
#Doesn't work for NM 2009 -- see "check bands"
#band_names <- normalized$bandNames()
#print(band_names$get(4)$getInfo())
rgb_bandMath <- function(image_given) {
#vari_exp = "((b('G') - b('R')) / (b('G') + b('R') - b('B')))";
mgrvi_exp = '((b("G")**2) - (b("R")**2) / ((b("G")**2) + (b("R")**2)))'
#vari <- image_given$expression(vari_exp)$rename('vari')
mgrvi <- image_given$expression(mgrvi_exp)$rename('mgrvi')
#ndvi <- normalized$normalizedDifference(c('N', 'R'))$rename('ndvi')
image_give <- image_given$addBands(vari)
image_give <- image_given$addBands(mgrvi)
}
normalized <- rgb_bandMath(normalized)
#Doesn't work for NM 2009 -- see "check bands"
#band_names <- normalized$bandNames()
#print(band_names$get(4)$getInfo())
rgb_bandMath <- function(image_given) {
#vari_exp = "((b('G') - b('R')) / (b('G') + b('R') - b('B')))";
mgrvi_exp = '((b("G")**2) - (b("R")**2) / ((b("G")**2) + (b("R")**2)))'
#vari <- image_given$expression(vari_exp)$rename('vari')
mgrvi <- image_given$expression(mgrvi_exp)$rename('mgrvi')
#ndvi <- normalized$normalizedDifference(c('N', 'R'))$rename('ndvi')
#image_give <- image_given$addBands(vari)
image_give <- image_given$addBands(mgrvi)
}
normalized <- rgb_bandMath(normalized)
band_names <- normalized$bandNames()
vari_param <- list(bands = 'mgrvi',
min = 0,
max = 1)
Map$addLayer(normalized, vari_param, 'vari')
#Doesn't work for NM 2009 -- see "check bands"
#band_names <- normalized$bandNames()
#print(band_names$get(4)$getInfo())
rgb_bandMath <- function(image_given) {
#vari_exp = "((b('G') - b('R')) / (b('G') + b('R') - b('B')))";
mgrvi_exp = 'b("G")**2 - b("R")**2 / b("G")**2 + b("R")**2'
#vari <- image_given$expression(vari_exp)$rename('vari')
mgrvi <- image_given$expression(mgrvi_exp)$rename('mgrvi')
#ndvi <- normalized$normalizedDifference(c('N', 'R'))$rename('ndvi')
#image_give <- image_given$addBands(vari)
image_give <- image_given$addBands(mgrvi)
}
normalized <- rgb_bandMath(normalized)
band_names <- normalized$bandNames()
vari_param <- list(bands = 'mgrvi',
min = 0,
max = 1)
Map$addLayer(normalized, vari_param, 'vari')
#Doesn't work for NM 2009 -- see "check bands"
#band_names <- normalized$bandNames()
#print(band_names$get(4)$getInfo())
rgb_bandMath <- function(image_given) {
#vari_exp = "((b('G') - b('R')) / (b('G') + b('R') - b('B')))";
mgrvi_exp = ' b("G")**2 - b("R")**2 / b("G")**2 + b("R")**2) '
#vari <- image_given$expression(vari_exp)$rename('vari')
mgrvi <- image_given$expression(mgrvi_exp)$rename('mgrvi')
#ndvi <- normalized$normalizedDifference(c('N', 'R'))$rename('ndvi')
#image_give <- image_given$addBands(vari)
image_give <- image_given$addBands(mgrvi)
}
normalized <- rgb_bandMath(normalized)
band_names <- normalized$bandNames()
vari_param <- list(bands = 'mgrvi',
min = 0,
max = 1)
Map$addLayer(normalized, vari_param, 'vari')
#Doesn't work for NM 2009 -- see "check bands"
#band_names <- normalized$bandNames()
#print(band_names$get(4)$getInfo())
rgb_bandMath <- function(image_given) {
#vari_exp = "((b('G') - b('R')) / (b('G') + b('R') - b('B')))";
mgrvi_exp = ' b("G")**2 - b("R")**2 / b("G")**2 + b("R")**2) '
#vari <- image_given$expression(vari_exp)$rename('vari')
mgrvi <- image_given$expression(mgrvi_exp)$rename('mgrvi')
#ndvi <- normalized$normalizedDifference(c('N', 'R'))$rename('ndvi')
#image_give <- image_given$addBands(vari)
image_give <- image_given$addBands(mgrvi)
}
normalized <- rgb_bandMath(normalized)
band_names <- normalized$bandNames()
vari_param <- list(bands = 'mgrvi',
min = 0,
max = 1)
Map$addLayer(normalized, vari_param, 'vari')
#Doesn't work for NM 2009 -- see "check bands"
#band_names <- normalized$bandNames()
#print(band_names$get(4)$getInfo())
rgb_bandMath <- function(image_given) {
#vari_exp = "((b('G') - b('R')) / (b('G') + b('R') - b('B')))";
mgrvi_exp = c(' (b("G")**2 - b("R")**2 / b("G")**2 + b("R")**2)')
#vari <- image_given$expression(vari_exp)$rename('vari')
mgrvi <- image_given$expression(mgrvi_exp)$rename('mgrvi')
#ndvi <- normalized$normalizedDifference(c('N', 'R'))$rename('ndvi')
#image_give <- image_given$addBands(vari)
image_give <- image_given$addBands(mgrvi)
}
normalized <- rgb_bandMath(normalized)
band_names <- normalized$bandNames()
vari_param <- list(bands = 'mgrvi',
min = 0,
max = 1)
Map$addLayer(normalized, vari_param, 'vari')
#Doesn't work for NM 2009 -- see "check bands"
#band_names <- normalized$bandNames()
#print(band_names$get(4)$getInfo())
rgb_bandMath <- function(image_given) {
#vari_exp = "((b('G') - b('R')) / (b('G') + b('R') - b('B')))";
mgrvi_exp = c(' (b("G")**2 - b("R")**2) / (b("G")**2 + b("R")**2) ')
#vari <- image_given$expression(vari_exp)$rename('vari')
mgrvi <- image_given$expression(mgrvi_exp)$rename('mgrvi')
#ndvi <- normalized$normalizedDifference(c('N', 'R'))$rename('ndvi')
#image_give <- image_given$addBands(vari)
image_give <- image_given$addBands(mgrvi)
}
normalized <- rgb_bandMath(normalized)
band_names <- normalized$bandNames()
vari_param <- list(bands = 'mgrvi',
min = 0,
max = 1)
Map$addLayer(normalized, vari_param, 'vari')
vari_exp <- "((b('G') - b('R')) / (b('G') + b('R') - b('B')))"
vari <- normalized$expression(vari_exp)$rename('vari')
vari_param <- list(bands = 'vari',
min = 0,
max = 1)
Map$addLayer(vari, vari_param, 'vari')
rgb_bandMath <- function(image_given) {
img_band_selected <- image_given$select(c("R", "G", "B"))
#mgrvi_exp = c(' (b("G")**2 - b("R")**2) / (b("G")**2 + b("R")**2) ')
#vari <- image_given$expression(vari_exp)$rename('vari')
#mgrvi <- image_given$expression(mgrvi_exp)$rename('mgrvi')
#ndvi <- normalized$normalizedDifference(c('N', 'R'))$rename('ndvi')
#image_give <- image_given$addBands(vari)
#image_give <- image_given$addBands(mgrvi)
image <-  img_band_selected #$updateMask(quality_mask)
img_band_selected <- image$expression(
expression = '(G - R) / (G + R - B)',
opt_map =  list(
'G' = image$select('G'),
'R' = image$select('R'),
'B' = image$select('B')
)
)
return(img_band_selected)
}
vari <- rgb_bandMath(normalized)
Map$addLayer(vari, vari_param, 'vari')
